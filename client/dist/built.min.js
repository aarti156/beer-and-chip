angular.module("myApp",["createEvent","eventList","eventDetails","ngRoute","auth","dndLists"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"/app/create/create.html",controller:"CreateController"}),a.when("/events",{templateUrl:"app/events/events.html",controller:"EventsController"}),a.when("/eventdetails/:eventID",{templateUrl:"app/eventdetails/eventdetails.html",controller:"eventDetailsController"}),a.when("/signin",{templateUrl:"app/auth/signin.html",controller:"AuthController"}),a.otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","AuthFactory",function(a,b,c){a.$on("$routeChangeStart",function(a,d){console.log(d),d.$$route&&"/events"===d.$$route.originalPath&&!c.isAuth()&&b.path("/signin"),d.$$route&&"/"===d.$$route.originalPath&&!c.isAuth()&&b.path("/signin"),d.$$route&&"/signin"===d.$$route.originalPath&&b.path("/signin")})}]),angular.module("auth",["ngCookies"]).controller("AuthController",function(a,b,c,d,e){a.user={},a.logout=function(){e.signout()}}).factory("AuthFactory",function(a,b,c,d){var e=function(){return!!d.get("displayName")},f=function(){var a=d.getAll();angular.forEach(a,function(a,b){d.remove(b)}),c.path("/signin")};return{isAuth:e,signout:f}}),angular.module("createEvent",[]).controller("CreateController",["$scope","CreateFactory","$location","$cookies",function(a,b,c,d){a.event={},a.hold={},a.data={},a.guests=[{}],a.items=[{}],a.addGuest=function(){a.guests.push({})},a.removeGuest=function(b){a.guests.splice(b,1)},a.addItem=function(){a.items.push({})},a.removeItem=function(b){a.items.splice(b,1)},a.update=function(e,f){a.data.userID=d.get("userID");for(var g=[],h=0;h<a.guests.length;h++)a.guests[h].name&&a.guests[h].email&&g.push(a.guests[h]);for(var i=[],j=0;j<a.items.length;j++)a.items[j]&&a.items[j].name&&i.push(a.items[j]);a.data.event=e,a.data.guests=g,a.data.items=i,b.addEvent(a.data).then(function(){c.path("/events")})},a.reset=function(){a.event={},a.hold={},a.guests=[{}],a.items=[{}],a.data={}},a.reset()}]).factory("CreateFactory",function(a,b){var c=function(b){return console.log("EVENT",b),a({method:"POST",url:"/api/events",data:b})};return{addEvent:c}}),angular.module("eventDetails",["eventList"]).controller("eventDetailsController",["$scope","$http","requestFactory","$cookies","$routeParams",function(a,b,c,d,e){a.itemName,a.guestName,a.guestEmail,a.resetField=function(b){a[b]=""},a.addItemFunc=function(c){var e={EventId:d.get("eventID"),name:c};return b({method:"POST",url:"/api/items",data:e}).then(function(){a.resetField("newItem")})},a.addGuestFunc=function(c,e){var f={EventId:d.get("eventID"),name:c,email:e};return b({method:"POST",url:"/api/guests",data:f}).then(function(){a.resetField("guestName"),a.resetField("guestEmail")})},a.models={selected:null,guests:{}};var f=a.models.guests,g=function(){c.getEvents(e.eventID).then(function(a){for(var b={},c=0;c<a.items.length;c++){var d=a.items[c].GuestId,e=a.items[c];b[d]?b[d].push(e):b[d]=[e]}for(var g=0;g<a.guests.length;g++){var h=a.guests[g].name,i=a.guests[g].id;f[h+" "+i]=b[i]?b[i]:[]}})};a.reassignItem=function(b,d){var e=a.getId(d);return c.updateItem(b,e),b},a.getId=function(a){var b=a.match(/([^\s])+/g);return b[1]},a.getName=function(a){var b=a.match(/([^\s])+/);return b[0]},a.email=function(){var a=d.get("eventID");c.sendEmails(a)},g()}]).factory("requestFactory",function(a,b){var c=function(b){return a({method:"GET",url:"/api/eventDetails/"+b}).then(function(a){return a.data})},d=function(b){return a({method:"GET",url:"/api/email/"+b})},e=function(b,c){return a({method:"PUT",url:"/api/items/"+b.id,data:{GuestId:c}}).then(function(){console.log("UPDATED DB")})};return{getEvents:c,sendEmails:d,updateItem:e}}),angular.module("eventList",[]).controller("EventsController",["$scope","EventFactory","$location","$cookies",function(a,b,c,d){a.data={};var e=function(){b.getEvents().then(function(b){a.data.events=b})["catch"](function(a){console.error("EventsController",a)})};a.getEvent=function(a){console.log("EVENT",a),d.put("eventID",a.id),c.path("/eventdetails/"+a.id)},e()}]).factory("EventFactory",function(a,b){var c=function(){return a({method:"GET",url:"/api/events/"+b.get("userID")}).then(function(a){return a.data})};return{getEvents:c}});